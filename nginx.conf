events {}

http {
  upstream user_service {
    server user:3000;
  }

  upstream questions_service {
    server questions:3000;
  }

  upstream matching_service {
    server matching:3000;
  }

  upstream collaboration_service {
    server collaboration:3000;
  }

  server {
    listen 80;

    location /user/ {
      rewrite ^/user/(.*) /$1 break;
      proxy_pass http://user_service;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
    }

    location /questions/ {
      rewrite ^/questions/(.*) /$1 break;
      proxy_pass http://questions_service;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
    }

    location /matching/ {
      rewrite ^/matching/(.*) /$1 break;
      proxy_pass http://matching_service;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
    }

    location /collaboration/ {
      rewrite ^/collaboration/(.*) /$1 break;
      proxy_pass http://collaboration_service;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
    }
  }
}
